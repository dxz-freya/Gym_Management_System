@{
    Layout = "../Shared/_AdminLayout.cshtml";
    ViewData["Title"] = "Dashboard";
}

@using GymManagement.Areas.Admin.Models
@model AdminDashboardViewModel

@{
    Dictionary<SessionCategory, string> categoryIcons = new()
{
{ SessionCategory.Yoga, "fa-person-praying" },
{ SessionCategory.Pilates, "fa-child-reaching" },
{ SessionCategory.StrengthTraining, "fa-dumbbell" },
{ SessionCategory.Cardio, "fa-heart-pulse" },
{ SessionCategory.HIIT, "fa-bolt" },
{ SessionCategory.DanceFitness, "fa-music" },
{ SessionCategory.Cycling, "fa-bicycle" }
};
}

<style>
    .dashboard-card {
        padding: 1.25rem;
        border-radius: 0.75rem;
        box-shadow: 0 2px 6px rgba(0, 0, 0, 0.08);
        transition: transform 0.2s ease-in-out;
        min-height: 120px;
    }

    .dashboard-card:hover {
        transform: translateY(-3px);
    }

    .dashboard-title {
        font-size: 1.1rem;
        font-weight: 600;
        margin-bottom: 0.3rem;
    }

    .dashboard-number {
        font-size: 2.2rem;
        font-weight: 800;
    }

    .session-name {
        display: flex;
        align-items: center;
        gap: 0.5rem;
    }
</style>

<!-- Summary Cards -->
<div class="row mb-4">
    <div class="col-md-4">
        <div class="bg-dark text-white dashboard-card text-center">
            <div class="dashboard-title">Total Sessions</div>
            <div id="totalSessions" class="dashboard-number">@Model.TotalSessions</div>
        </div>
    </div>
    <div class="col-md-4">
        <div class="bg-primary text-white dashboard-card text-center">
            <div class="dashboard-title">Total Members</div>
            <div id="totalMembers" class="dashboard-number">@Model.TotalMembers</div>
        </div>
    </div>
    <div class="col-md-4">
        <div class="bg-dark text-white dashboard-card text-center">
            <div class="dashboard-title">Total Trainers</div>
            <div id="totalTrainers" class="dashboard-number">@Model.TotalTrainers</div>
        </div>
    </div>
</div>

<!-- Session Tables -->
@foreach (var kv in Model.UpcomingSessionsByDate)
{
    var date = kv.Key;
    var sessions = kv.Value;
    string title;

    if (date.Date == DateTime.Today)
    {
        title = "Today's sessions (" + date.ToString("MMM dd, yyyy") + ")";
    }
    else if (date.Date == DateTime.Today.AddDays(1))
    {
        title = "Tomorrow's sessions (" + date.ToString("MMM dd, yyyy") + ")";
    }
    else
    {
        title = "Sessions (" + date.ToString("MMM dd, yyyy") + ")";
    }

    <div class="card p-4 mb-4">
        <div class="d-flex justify-content-between align-items-center mb-3">
            <h5 class="fw-bold text-success">@title</h5>
            <a asp-action="CreateSession" asp-controller="Admin" class="btn btn-success btn-sm">
                + Create a session
            </a>
        </div>
        <div class="table-responsive">
            <table class="table table-hover bg-white text-center align-middle">
                <thead class="table-light">
                    <tr>
                        <th>Session</th>
                        <th>Time</th>
                        <th>Trainer</th>
                        <th>Branch</th>
                        <th>Room</th>
                        <th>Capacity</th>
                        <th>Bookings</th>
                        <th>Attendance</th>
                    </tr>
                </thead>
                <tbody>
                    @foreach (var s in sessions)
                    {
                        <tr>
                            <td class="text-start">
                                <span class="session-name">
                                    <i
                                        class="fa-solid @(categoryIcons.TryGetValue(s.Category, out var icon) ? icon : "fa-calendar")"></i>
                                    @s.SessionName
                                </span>
                            </td>
                            <td>@s.SessionDateTime.ToString("HH:mm / MMM dd, yyyy")</td>
                            <td>@s.Trainer?.Name</td>
                            <td>@s.Trainer?.GymBranch?.BranchName</td>
                            <td>@s.Room?.RoomName</td>
                            <td>@s.Capacity</td>
                            <td>0</td>
                            <td>0</td>
                        </tr>
                    }
                </tbody>
            </table>
        </div>
    </div>
}

@section Scripts {
    <script src="https://cdnjs.cloudflare.com/ajax/libs/countup.js/1.9.3/countUp.min.js"></script>
    <script>
        document.addEventListener('DOMContentLoaded', function () {
            var options = {
                useEasing: true,
                useGrouping: true,
                separator: ',',
                decimal: '.'
            };

            var count1 = new CountUp('totalSessions', 0, @Model.TotalSessions, 0, 2.0, options);
            var count2 = new CountUp('totalMembers', 0, @Model.TotalMembers, 0, 2.0, options);
            var count3 = new CountUp('totalTrainers', 0, @Model.TotalTrainers, 0, 2.0, options);

            if (!count1.error) count1.start(); else console.error(count1.error);
            if (!count2.error) count2.start(); else console.error(count2.error);
            if (!count3.error) count3.start(); else console.error(count3.error);
        });
    </script>
    <script src="https://kit.fontawesome.com/your-kit-code.js" crossorigin="anonymous"></script>
}
