@using Microsoft.AspNetCore.Identity
@inject Microsoft.AspNetCore.Mvc.Rendering.IHtmlHelper Html
@inject Microsoft.AspNetCore.Http.IHttpContextAccessor HttpContextAccessor
@inject UserManager<GymManagement.Models.User> UserManager
@inject SignInManager<GymManagement.Models.User> SignInManager

@{
    var currentController = HttpContextAccessor.HttpContext?.Request.RouteValues["controller"]?.ToString();
    var currentAction = HttpContextAccessor.HttpContext?.Request.RouteValues["action"]?.ToString();
    var currentUser = await UserManager.GetUserAsync(User);
    var displayName = currentUser?.Name ?? User.Identity?.Name ?? "User";

    var roles = currentUser != null ? await UserManager.GetRolesAsync(currentUser) : new List<string>();
    bool isOnlyAdmin = roles.Count == 1 && roles.Contains("Admin");

    string logoController = "Home";
    string logoAction = "Index";

    if (!isOnlyAdmin)
    {
        if (roles.Contains("Trainer"))
        {
            logoController = "Trainer";
            logoAction = "Dashboard";
        }
        else if (roles.Contains("Receptionist"))
        {
            logoController = "Receptionist";
            logoAction = "ManageBookings";
        }
        else if (roles.Contains("Customer"))
        {
            logoController = "Customer";
            logoAction = "Dashboard";
        }
    }
}

<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="utf-8" />
    <title>Admin Overview - GymManagement</title>
    <link href="~/css/bootstrap.min.css" rel="stylesheet" />
    <link href="~/css/style.css" rel="stylesheet" />
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css" rel="stylesheet">


    <style>
        html,
        body {
            background-color: #f3f4f6 !important;
            color: #212529 !important;
        }

        .bg-sidebar {
            background-color: #f3f4f6;
        }

        .bg-content {
            background-color: #ffffff;
        }
    </style>
</head>

<body>
    <div class="d-flex">
        <!-- Sidebar -->
        <div class="bg-sidebar border-end vh-100 p-3" style="width: 250px;">
            <div class="mb-4">
                <div class="logo text-center mb-3">
                    <a asp-area="" asp-controller="@logoController" asp-action="@logoAction">
                        <img src="~/img/logo.png" alt="Gym Logo"
                            style="filter: drop-shadow(0px 2px 4px rgba(0, 0, 0, 0.3));" />
                    </a>
                </div>
            </div>
            @{
                string NavLinkClass(string ctrl, string act) =>
                (currentController == ctrl && currentAction == act)
                ? "nav-link text-dark fw-bold active bg-white rounded px-3 py-2 shadow-sm"
                : "nav-link text-dark px-3 py-2";
            }

            <ul class="nav flex-column">
                <li class="nav-item">
                    <a class="@NavLinkClass("Admin", "Dashboard")" asp-area="Admin" asp-controller="Admin"
                        asp-action="Dashboard">Overview</a>
                </li>
                <li class="nav-item">
                    <a class="@NavLinkClass("Admin", "ManageSessions")" asp-area="Admin" asp-controller="Admin"
                        asp-action="ManageSessions">Create a session</a>
                </li>
                <li class="nav-item">
                    <a class="@NavLinkClass("User", "Index")" asp-area="Admin" asp-controller="User"
                        asp-action="Index">My employees</a>
                </li>
            </ul>
        </div>

        <!-- Main Content -->
        <div class="bg-content flex-grow-1 p-4" style="overflow-x: auto;">
            <!-- Header -->
            <div class="d-flex justify-content-between align-items-center mb-4">
                <div>
                    @{
                        string currentPageLabel = currentController switch
                        {
                            "Admin" when currentAction == "Dashboard" => "Overview",
                            "Admin" when currentAction == "ManageSessions" => "Create a session",
                            "User" when currentAction == "Index" => "My employees",
                            _ => currentAction
                        };
                    }
                    <h5 class="text-muted">Dashboard / <span class="text-dark">@currentPageLabel</span></h5>
                </div>
                @if (SignInManager.IsSignedIn(User))
                {
                    <div class="d-flex align-items-center gap-3">
                        <span class="text-dark">Hello, @displayName!</span>
                        <form asp-area="" asp-controller="Account" asp-action="Logout" method="post" class="d-inline">
                            <button type="submit" class="btn btn-outline-secondary btn-sm">LOGOUT</button>
                        </form>
                    </div>
                }
            </div>

            @RenderBody()
        </div>
    </div>


    <!-- Scripts -->
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <script src="~/lib/bootstrap/dist/js/bootstrap.bundle.min.js"></script>

    @await RenderSectionAsync("Scripts", required: false)

</body>

</html>
